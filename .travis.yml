language: java
jdk:
  - openjdk8
services:
  - docker

env:
  global:
   - secure: "iBWgojeFoD1tNUICWWC0ndOKAYcgyfNXbD9qcV/a0zMYHokg/P7FBqI753wgeW1PkNYymY1bqzY/1wtGYpzqrPhJpoiRVx7COasYKWfpYC1D2PPzVRKCmM1XgUr8ujtSk1+l+k5d7tOPspsrtA+6aQ5nFkEUqQHzGETcpv71dW9Nh30W78KFkk/4tQNQ/xulLQxXW5kQNbHAMvJbS91vGGGReuCV0YP7I8lThF/vC6d03jFkbHYL/F32yMQia0UczfPCJ2+QqvRyfDTn7bFuBadgnw+Hqpp0WtIzB0Es9nMTYg82U1R5z+1SRwE1yyB3CJ+iSRi48459IR6xxOnfdbAeHiLm2PPgcc85ixUvSXiQYqbvrPEcDnIyVqI3eci8U+5Tu4xQTVll9nvUwJp8Djleyadwy4RcpACzXIpmL59gbPA85d1kIYv/74hqdL/T9PXpj2MHePxBjn8vWY1rPT7+9fm1/uCruWHh2+kSo6Q+N0vJ2uE43vHGyk6i2i+X1WEPyqWEGziDOJHmj1WWQGELqGHMa40o9t3FshuufUzhHjEUyHC2ATxHGzZR3Ptxu4Mq1wUXCJH4bV8JrLsIg6vonp1GC/QL1bSSCWYw9Yq9AS0jNQ9Z3yFm05cSm0mQBQc1UtCZrIqEWQLTIFbEa6Adm8NHFELx3X29AiWD3GE="
   - secure: "uaXeFyOEijCvArlYDMho+alUKYc5JqD/+EOtw3MqtoJDtRDcsFKVZ+pS038cOcFhqLhSDBPhRQC6+iPZ12K0jxGfjy5rZ5ULYlq3aq+XtcApb3n8Jh2C023cIAcZV1HXCuRwB3Jl5HWA91l+Ueefb0ClsSxXwOmlPmfDtBLWkZwqpCnSP1J5R7/L+6BtVGJvsQr+249vomr7KMlbekNUoZcNQiI/9bZA/LLqo5lFG0/5CzIeEzJz+7D1dE0lSdJkrJ5nCMDb3BK1tNCqo8tSNRobgl4RgCLgGVmFBh0PUnlr6HEYTxHOveRZ30Dz4Gr4AaE3o29T2ryXGg8QscRE9hj5WZ/CPnXoG5XTPjDLYX3BO2O6KrwuaXdQajyGj7XHVqlbAZIdGVAcCXgz3b3Lm5/u4JJb4xgnkQKXEN/pYHcqWDxf+uUba3xDBP0S/W26OURs9z8mi7HD5Jp9oEpcAj8FIF5Xx8o4IVuAiP71JnJ6aHnVs0XL5OZrj4ZxI+o6WFDk1mlWl6DVMMXUB7WqEBUiAoxlkTAdqjYodmf1US8icHuHK61v7O5/nzOsd8ch1EKUHsbjMIJrRM47/asaFMW6a2oReyHaxyySoPjcovn2GJKXnrsL+b0DvvzKK1dnP1OGUjWDLSMcafMUkZW9AhOhSqc6GCCbeCquJpNaI90="
   - COMMIT=${TRAVIS_COMMIT::7}
   - IMAGE_NAME=tabletennistournament/match-management-server

before_install:
  - chmod +x mvnw
  - docker pull openjdk:8-jdk-alpine

script:
  - ./mvnw clean install -B

after_success:
  - export TAG=`if [ ! -z "$TRAVIS_TAG" ]; then echo "$TRAVIS_TAG"; else echo "$TRAVIS_BRANCH-$COMMIT"; fi`
  - docker login -u $DOCKER_USER -p $DOCKER_PASSWORD
  - docker build . -t $IMAGE_NAME:latest
  - docker tag $IMAGE_NAME:latest $IMAGE_NAME:$TAG
  - docker push $IMAGE_NAME:latest
  - docker push $IMAGE_NAME:$TAG
  - export TITLE="$IMAGE_NAME:$TAG is built properly and pushed to Dockerhub"
  - export TIMESTAMP=`date`
  - export GIT_LOG=`git log -1 --pretty=%B $COMMIT`
  - export TEXT="[build version] $TAG<br />[datetime] $TIMESTAMP<br />[changelog] $GIT_LOG<br />"

cache:
  directories:
    - '$HOME/.m2/repository'
